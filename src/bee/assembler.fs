\ Bee assembler for pForth
\
\ (c) Reuben Thomas 2020
\
\ The package is distributed under the GNU GPL version 3, or, at your
\ option, any later version.
\
\ THIS PROGRAM IS PROVIDED AS IS, WITH NO WARRANTY. USE IS AT THE USERâ€™S
\ RISK.

CR .( Bee assembler )


VOCABULARY ASSEMBLER  ALSO ASSEMBLER DEFINITIONS

: INLINE   ( char -- )   LAST >INFO 2 + C! ;

FORTH DEFINITIONS
INCLUDE" code.fs"
: END-CODE   ALIGN  PREVIOUS ;
ASSEMBLER DEFINITIONS

: OFFSET   ( from to -- offset )   >-< ;
: OFFSET,   ( to -- )   HERE SWAP OFFSET , ;
: NUMBER>OPCODE   1 LSHIFT  1+ ;
: OPLESS   CREATE NUMBER>OPCODE ,  DOES> @ , ;
: OPFUL   CREATE NUMBER>OPCODE ,  DOES> @ , , ;
: OPADR   CREATE NUMBER>OPCODE ,  DOES> @ ,  OFFSET, ;

: 0OPS   SWAP 1+ SWAP DO  I OPLESS  LOOP ;

 2  0 0OPS BDROP   BPICK   BROLL
 5  3 0OPS B>R     BR>     BR@
 9  6 0OPS BS0@    BS0!    BSP@    BSP!
13 10 0OPS BR0@    BR0!    BRP@    BRP!
14 OPLESS  BMEMORY@
15 OPLESS  BCELL
19 16 0OPS B@      B!      BC@     BC!
24 20 0OPS B+      BNEGATE B*      BU/MOD  BS/REM
27 25 0OPS B=      B<      BU<
31 28 0OPS BINVERT BAND    BOR     BXOR
33 32 0OPS BLSHIFT BRSHIFT
36 34 0OPS BEXIT   BEXECUTE BHALT

37 OPFUL B(LITERAL)
38 OPFUL B(OFFSET)
39 OPADR BBRANCH
40 OPADR B?BRANCH

130 128 0OPS BARGC BARGLEN BARGCOPY
133 131 0OPS BSTDIN BSTDOUT BSTDERR
135 134 0OPS BOPEN-FILE BCLOSE-FILE
137 136 0OPS BREAD-FILE BWRITE-FILE
139 138 0OPS BFILE-POSITION BREPOSITION-FILE
142 140 0OPS BFLUSH-FILE BRENAME-FILE BDELETE-FILE
144 143 0OPS BFILE-SIZE BRESIZE-FILE
145 OPLESS   BFILE-STATUS

PREVIOUS DEFINITIONS
