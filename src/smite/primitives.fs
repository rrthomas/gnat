CR .( Required primitives )

ALSO ASSEMBLER \ For INLINE


\ Stack primitives

1 0 PRIMITIVE DROP
] 1 [ BPOP
END-PRIMITIVE

1 1 PRIMITIVE PICK
BPUSH
END-PRIMITIVE

\ FIXME: Implement ROLL
\ 1 1 PRIMITIVE ROLL

2 2 PRIMITIVE SWAP
] 1 [ BSWAP
END-PRIMITIVE

1 0 PRIMITIVE >R
BPOP2R
END-PRIMITIVE

0 1 PRIMITIVE R>
BRPOP
END-PRIMITIVE

\ Don't use END-PRIMITIVE as R@ can't be INLINE
0 1 PRIMITIVE R@
] 1 [ BRPUSH
END-PRIMITIVE-CODE
BRET
END-CODE

0 1 PRIMITIVE CELL
] 4 [
END-PRIMITIVE

0 1 PRIMITIVE -CELL
] -4 [
END-PRIMITIVE

0 1 PRIMITIVE NATIVE-POINTER-CELLS
BPUSH_NATIVE_POINTER_SIZE
CELL LITERAL,
BUDIVMOD
] 1 [ BPOP
END-PRIMITIVE


\ Stack management primitives

0 1 PRIMITIVE SP@
BPUSH_SDEPTH
CELL LITERAL,
BMUL
END-PRIMITIVE

1 0 PRIMITIVE SP!
CELL LITERAL,
BUDIVMOD
] 1 [ BPOP
BSTORE_SDEPTH
END-PRIMITIVE

0 1 PRIMITIVE RP@
BPUSH_RDEPTH
CELL LITERAL,
BMUL
END-PRIMITIVE

\ FIXME: only works when inlined
1 0 PRIMITIVE RP!
CELL LITERAL,
BUDIVMOD
] 1 [ BPOP
BSTORE_RDEPTH
END-PRIMITIVE

0 CONSTANT S0
0 CONSTANT R0

0 1 PRIMITIVE STACK-CELLS
BPUSH_SSIZE
END-PRIMITIVE

0 1 PRIMITIVE RETURN-STACK-CELLS
BPUSH_RSIZE
END-PRIMITIVE

0 1 PRIMITIVE MEMORY@
BPUSH_MEMORY
END-PRIMITIVE


\ Memory primitives

1 1 PRIMITIVE @
BLOAD
END-PRIMITIVE

2 0 PRIMITIVE !
BSTORE
END-PRIMITIVE

1 1 PRIMITIVE C@
BLOADB
END-PRIMITIVE

2 0 PRIMITIVE C!
BSTOREB
END-PRIMITIVE


\ Arithmetic and logical primitives

2 1 PRIMITIVE +
BADD
END-PRIMITIVE

2 1 PRIMITIVE -
BNEGATE BADD
END-PRIMITIVE

1 1 PRIMITIVE NEGATE
BNEGATE
END-PRIMITIVE

2 1 PRIMITIVE *
BMUL
END-PRIMITIVE

2 2 PRIMITIVE U/MOD
BUDIVMOD
] 1 [ BSWAP
END-PRIMITIVE

2 2 PRIMITIVE S/REM
BDIVMOD
] 1 [ BSWAP
END-PRIMITIVE

2 1 PRIMITIVE =
BEQ
BNEGATE
END-PRIMITIVE

2 1 PRIMITIVE <
BLT
BNEGATE
END-PRIMITIVE

2 1 PRIMITIVE U<
BULT
BNEGATE
END-PRIMITIVE

2 1 PRIMITIVE AND
BAND
END-PRIMITIVE

2 1 PRIMITIVE OR
BOR
END-PRIMITIVE

2 1 PRIMITIVE XOR
BXOR
END-PRIMITIVE

1 1 PRIMITIVE INVERT
BINVERT
END-PRIMITIVE

2 1 PRIMITIVE LSHIFT
BLSHIFT
END-PRIMITIVE

2 1 PRIMITIVE RSHIFT
BRSHIFT
END-PRIMITIVE


\ Control primitives

INCLUDE" bracket-create.fs"
INCLUDE" bracket-does.fs"


\ System primitives

1 0 PRIMITIVE HALT
BHALT
END-PRIMITIVE


PREVIOUS
