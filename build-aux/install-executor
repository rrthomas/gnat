#!/bin/sh
# Install executor (used for Travis build)

HOST=$1
unset OAUTH_PARAMETER
if test "$GITHUB_TOKEN" != ""; then
    OAUTH_PARAMETER="?access_token=$GITHUB_TOKEN"
fi

cd $HOME

case $HOST in
    beetle)
        # From https://gist.github.com/steinwaywhw/a4cd19cda655b8249d908261a62687f8
        LATEST_RELEASE=`curl https://api.github.com/repos/rrthomas/beetle/releases/latest$OAUTH_PARAMETER | grep tag_name | sed -e 's/.*tag_name": "\([^"]*\).*/\1/'`
        LATEST_RELEASE_NUMBER=`echo $LATEST_RELEASE | sed -e s/^v//`
        FILE=beetle-$LATEST_RELEASE_NUMBER.tar.gz
        curl -L https://github.com/rrthomas/beetle/releases/download/$LATEST_RELEASE/$FILE -o $FILE
        tar zxf $FILE
        cd beetle-$LATEST_RELEASE_NUMBER
        ./configure --enable-silent-rules && make check && sudo make install
        ;;
    smite)
        git clone https://github.com/rrthomas/smite.git
        cd smite
        git submodule update --init --recursive
        ./bootstrap && ./configure --enable-silent-rules && make check && sudo make install
        ;;
esac
